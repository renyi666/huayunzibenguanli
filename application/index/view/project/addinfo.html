<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <link href="img/logo.ico" rel="shortcut icon">
    <title>创建项目</title>
    <link rel="stylesheet" href="__PUBLIC__/Project/css/zui.css">
    <link rel="stylesheet" href="__PUBLIC__/Project/css/css.css">
    <link rel="stylesheet" href="__PUBLIC__/Project/css/iconfont.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Project/css/webuploader.css" />
    <script>
    (function () {
        var js;
        if (typeof JSON !== 'undefined' && 'querySelector' in document && 'addEventListener' in window) {
            js = 'http://cdn.bootcss.com/jquery/2.0.3/jquery.min.js';
        } else {
            js = 'http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js';
        }
        document.write('<script src="' + js + '"><\/script>');
    }());
</script>
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5 shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--[if IE 6]>
    <script src="__PUBLIC__/js/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>
        /* EXAMPLE */
        DD_belatedPNG.fix('img,.mail,.header-top-left,.header-top-right ul li a:hover,.aaa,.ztxw-right');

        /* string argument can be any CSS selector */
        /* .png_bg example is unnecessary */
        /* change it to what suits you! */
    </script>
    <![endif]-->

</head>
<body style="background:#ececec">
    <header>
    	<div class="head-top">
    		<div class="head-top-cont">
    			<h2>华运资本</h2>
    			<h3>您好，某某某<span>退出</span></h3>
    		</div>
    	</div>
    	<div class="head-bottom">
    		<a href="index.html" class="active">项目库</a>
    		<a href="index.html">机构设置</a>
			<a href="index.html">成员管理</a>
			<a href="set-user.html">账号设置</a>
    	</div>
    </header>
    <div class="container-fluid">
    	<div class="add-project-cont">
    		<div class="ap-cont-top">
    			<h2>创建项目</h2>
    			<h4>请认真填写公司信息，尽可能填写得完善。投资人只有充分了解公司信息后，才会决定是否投资</h4>
    		</div>
    		<div class="ap-cont-bottom">
    			<div class="apcb-info-group">
    				<form enctype="multipart/form-data"  action="Project/add" method="post">
						<input type="hidden" value="{$data.company_url}" name="company_url"  class="company_url">
						<input type="hidden" value="{$data.company_name}" name="company_name" class="company_name">
						<input type="hidden" value="{$data.category_id}" name="category_id" class="category_id">
						<input type="hidden" id="image_url" value="" class="image_url">
    					<h4>基本信息</h4>
	    				<div class="apcb-info-item">
	    					<label>所在地</label>
	    					<select class="apcb-info-selsect" id="province">
								<option value="">请选择</option>
								{volist name="province" id="pr"}
	    						<option value="{$pr.id}">{$pr.name}</option>
								{/volist}
	    					</select>

	    					<select class="apcb-info-selsect" id="city">
	    						<option value="">请选择</option>
	    					</select>
	    				</div>
	    				<div class="apcb-info-item">
	    					<label>注册时间</label>
	    					<select class="apcb-info-selsect" id="year">
								{volist name="year" id="year"}
	    						<option>{$year.year}</option>
								{/volist}
	    					</select>
	    					<select class="apcb-info-selsect" id="month">
								{volist name="month" id="month"}
	    						<option>{$month.month}</option>
								{/volist}
	    					</select>
	    					<span>--至今</span>
	    				</div>
	    				<div class="apcb-info-item">
	    					<label>公司介绍</label>
	    					<textarea placeholder="如：华运资本是一个项目投资公司" class="apcb-textarea" id="company-info"></textarea>
	    				</div>
    				</form>
    			</div>
    			<div class="apcb-info-group">
    				<form>
    					<h4>团队介绍</h4>
	    				<div class="apcb-info-item">
	    					<label>团队成员介绍</label>
	    					<textarea placeholder="如：华运资本是一个项目投资公司" class="apcb-textarea"id="team-info" value=""></textarea>
	    				</div>
    				</form>
    			</div>
    			<div class="apcb-info-group">
    				<form>
    					<h4>项目介绍</h4>
    					<div class="apcb-info-item">
	    					<label>项目logo</label>
							   <!--dom结构部分-->
							<div id="uploader-demo">
							    <!--用来存放item-->
							    <div id="fileList" class="uploader-list"></div>
							    <div id="filePicker">上传图片</div>
							    <input type="hidden" id="image" />


							</div>
	    				</div>
	    				<div class="apcb-info-item">
	    					<label>项目全称</label>
		    				<input type="text" value="" placeholder="请填写项目名称。如：华运资本" ng-maxlength="30" class="apcb-input" id="project-name"/>
	    				</div>
	    				<div class="apcb-info-item">
	    					<label><span class="require"></span>一句话介绍</label>
		    				<input type="text" value="" placeholder="请填写项目名称。如：华运资本" ng-maxlength="30" class="apcb-input" id="yi-info"/>
	    				</div>
	    				<div class="apcb-info-item">
	    					<label>项目详细介绍</label>
	    					<textarea id="content" name="content" class="form-control kindeditor" style="height:150px;" value="">Hello, world!</textarea>
	    				</div>
	    				<button class="apbc-button" id="yes" type="button">完成</button>
	    				<a href="{:url('addProject')}" class="again-project">重新创建</a>
						<div class="cerror">必填项不可为空</div>
    				</form>
    			</div>
    		</div>
    	</div>
    </div>
    
    
    

<script src="__PUBLIC__/js/webuploader.js"></script>
<script src="__PUBLIC__/kindeditor/kindeditor-all-min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/js.js" ></script>
<script type="text/javascript">
    window.editor=KindEditor.create('textarea.kindeditor', {
    basePath: '__PUBLIC__/kindeditor/',
    allowFileManager : true,
    bodyClass : 'article-content',
});
	//用户退出
	$('.out').click(function () {

		window.location.href="{:url('Ucenter/logout')}"

	})

    $("#province,#city,#year,#month,#company-info,#team-info,#image,#project-name,#yi-info,#content").focus(function(){
    	$(".cerror").hide()
    });
    $("#yes").click(function(){
    	var image_url		=	"/vc/public/uploads/image/"+$('.image_url').val();
		var company_url		=	$('.company_url').val();
		var company_name		=	$('.company_name').val();
		var category_id		=	$('.category_id').val();

		var province		=	$("#province").val();
    	var city			=	$("#city").val();
    	var year			=	$("#year").val();
    	var month			=	$("#month").val();
    	var companyInfo		=	$("#company-info").val();
    	var teamInfo		=	$("#team-info").val();
    	var projectImage	=	$("#image").val();
    	var name			=	$("#project-name").val();
    	var yiInfo			=	$("#yi-info").val();
//    	var projectInfo		=	$("#content").text();
		html1=editor.html();
//		console.log(image_url);
//		console.log(projectImage);
//		console.log(company_url);
//		console.log(company_name);
//		console.log(category_id);
		console.log(province);
//		console.log(city);
//		console.log(year);
//		console.log(month);
//		console.log(companyInfo);
//		console.log(teamInfo);
//		console.log(name);
//		console.log(yiInfo);




    	if(province==''|| city=='' || year=='' ||  month=='' || companyInfo=='' ||  teamInfo=='' || projectImage=='' || name=='' || yiInfo=='' || province==null || city==null || year==null || month==null || companyInfo==null ||  teamInfo==null || projectImage==null|| name==null || yiInfo==null ||  province==undefined || city==undefined || year==undefined || month==undefined || companyInfo==undefined ||  teamInfo==undefined || projectImage==undefined || name==undefined || yiInfo==undefined ){
    		$(".cerror").show();

    	}else{

			$.ajax(
					{
						url: "{:url('Project/add')}",
						data: {project_logo : image_url ,companyUrl:company_url,companyName:company_name,categoryId:category_id,companyProvince:province,companyCity:city,companyYear:year,companyMonth:month,companyBrief:companyInfo,team:teamInfo,projectName:name,projectBrief:yiInfo,projectDescription:html1},
						dataType: 'json',
						method: 'post',
						success: function (data) {
							if(data=="SUCCESS"){

								window.location.href="{:url('index')}"
							}
						}

//

					}


			)
    	}
    	
    });

	$('#province').change(function () {
		var id	=	$('#province').val();
		console.log(id);
		$.ajax(
				{
					url: '{:url('Province/getById')}',
					data: {id: id},
					dataType: 'json',
					method: 'post',
					success: function (data) {
			console.log(data)
			$("#city").empty();
			for(x in data){
				//x表示是下标，来指定变量，指定的变量可以是数组元素，也可以是对象的属性。
				console.log(data[x]);
				$("#city").append("<option value='" + data[x].id + "'>" + data[x].name + "</option>");
			}
//			$(data).each(function () {
//
//				//$("#SltType1").options.append( this.ItemNo , this.ItemName );
//				$("#choose2").append("<option value='" + data.id + "'>" + data.name + "</option>");
//			});


					}


				}
		)
	})
    $("#project-name").focus(function(){
    	$(".cerror").hide()
    });
</script>
<script>

    var uploader = WebUploader.create({

        // 选完文件后，是否自动上传。
        auto: true,

        // swf文件路径
        swf: 'http://cdn.staticfile.org/webuploader/0.1.5/Uploader.swf',

        // 文件接收服务端。
//        server: 'http://dev.51h1h.com/public/file/uploadimage.html',
//
//		server: 'http://vc.51h1h.com/public/index/file/image.html',
		server: 'http://localhost/vc/public/index/file/image.html',
        // 选择文件的按钮。可选。
        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: '#filePicker',
        method: 'POST',
        // 只允许选择图片文件。
        accept: {
            title: 'Images',
            extensions: 'gif,jpg,jpeg,bmp,png',
            mimeTypes: 'image/*'
        },
        fileVal: 'image'
    });

    // 当有文件添加进来的时候
    uploader.on( 'fileQueued', function( file ) {
        var $li = $(
                        '<div id="' + file.id + '" class="file-item thumbnail">' +
                        '<img>' +
                        '</div>'
                ),
                $img = $li.find('img');


        var $list   =   $('#fileList');
        var $lis    =   $list.children('.file-item');
        if($list.length > 0){
            $list.empty();
        }
        $list.append( $li );

        // 创建缩略图
        // 如果为非图片文件，可以不用调用此方法。
        // thumbnailWidth x thumbnailHeight 为 100 x 100
        uploader.makeThumb( file, function( error, src ) {
            if ( error ) {
                $img.replaceWith('<span>不能预览</span>');
                return;
            }


            $img.attr( 'src', src );
        }, 100, 100 );
    });
    uploader.on( 'uploadProgress', function( file, percentage ) {
        var $li = $( '#'+file.id ),
                $percent = $li.find('.progress span');

        // 避免重复创建
        if ( !$percent.length ) {
            $percent = $('<p class="progress"><span></span></p >')
                    .appendTo( $li )
                    .find('span');
        }

        $percent.css( 'width', percentage * 100 + '%' );
    });

    // 文件上传成功，给item添加成功class, 用样式标记上传成功。
uploader.on( 'uploadSuccess', function( file,response  ) {

    	console.log(response.save_path);
		console.log(response.save_name);
	$('.image_url').val(response.save_name);
        $( '#'+file.id ).addClass('upload-state-done');
        $('#image').val(response.save_path);


});

// 文件上传失败，显示上传出错。
uploader.on( 'uploadError', function( file ) {
    var $li = $( '#'+file.id ),
            $error = $li.find('div.error');

    // 避免重复创建
    if ( !$error.length ) {
        $error = $('<div class="error"></div>').appendTo( $li );
    }

    $error.text('上传失败');
});

// 完成上传完了，成功或者失败，先删除进度条。
uploader.on( 'uploadComplete', function( file ) {
    $( '#'+file.id ).find('.progress').remove();
});
</script>
</body>
</html>
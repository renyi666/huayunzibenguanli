<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <link href="img/logo.ico" rel="shortcut icon">
    <title>账号注册</title>
    <link rel="stylesheet" href="__PUBLIC__/Project/css/zui.css">
    <link rel="stylesheet" href="__PUBLIC__/Project/css/css.css">
    <link rel="stylesheet" href="__PUBLIC__/Project/css/iconfont.css">
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5 shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--[if IE 6]>
    <script src="__PUBLIC__/js/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>
        /* EXAMPLE */
        DD_belatedPNG.fix('img,.mail,.header-top-left,.header-top-right ul li a:hover,.aaa,.ztxw-right');

        /* string argument can be any CSS selector */
        /* .png_bg example is unnecessary */
        /* change it to what suits you! */
    </script>
    <![endif]-->

</head>
<body style="background:#ececec;position: relative;">
<div class="bj"></div>
<header>
    <div class="head-top">
        <div class="head-top-cont">
            <h2>{$organization.name}</h2>

        </div>
    </div>
    <div class="head-bottom">
        {volist name="menu_result" id="menu_res"}
        {if condition="$menu_res.id eq 3"}
        <a href="{:url($menu_res['url'])}" class="active">{$menu_res.title}</a>{else/}

        <a href="{:url($menu_res['url'])}">{$menu_res.title}</a>
        {/if}
        <!--<a href="{:url('index')}" class="active">项目管理</a>-->
        <!--<a href="{:url('Department/index')}">机构设置</a>-->
        <!--<a href="{:url('Ucenter/index')}">成员管理</a>-->
        {/volist}
        <h3>您好，{$userInfo.user_name}<span class="out">退出</span></h3>

    </div>
</header>
<div class="container-fluid">
    <div class="add-user">
        <div class="add-user-head">
            <div class="auh-button">
                创建账号
            </div>
        </div>
        <div class="add-user-tab">
            <table>
                <thead>
                <tr>
                    <th>工号</th>
                    <th >姓名</th>
                    <th >账号</th>
                    <th>直属上级</th>
                    <th >操作</th>
                </tr>
                </thead>
                <tbody>
                {volist name="list" id="list"}
                {if  condition="$list.status eq 1"}
                <tr>
                    <td >{$list.user_no}</td>
                    <td >{$list.user_name}</td>
                    <td >{$list.mobile}</td>
                    <td >
                        {if condition="$list.remark eq 1"}
                        {else/}
                        {$list.remark_name}
                        {/if}</td>
                    <td class="operation ">
                        {if condition="$list.status eq 1"}
                        <h4 data-id="{$list['id']}" data-status="{$list['status']}"style="color: #323232; background: #f00" >停用</h4>
                        {else/}
                        <h4 data-id="{$list['id']}" data-status="{$list['status']}" style="color: #999;background:green ">启用</h4>
                        {/if}

                        <h5 data-id="{$list['id']}" data-status="{$list['status']}" data-name="{$list['user_name']}" data-no="{$list['user_no']}" data-mobile="{$list['mobile']}" >编辑</h5>

                    </td>
                </tr>
                {else/}
                <tr>
                    <td  style="color: #999;">{$list.user_no}</td>
                    <td style="color: #999;">{$list.user_name}</td>
                    <td style="color: #999;">{$list.mobile}</td>
                    <td style="color: #999;">{$list.remark_name}</td>
                    <td class="operation ">
                        {if condition="$list.status eq 1"}
                        <h4 data-id="{$list['id']}" data-status="{$list['status']}"style="color: #323232; background: #f00" >停用</h4>
                        {else/}
                        <h4 data-id="{$list['id']}" data-status="{$list['status']}" style="color: #999;background:green ">启用</h4>
                        {/if}
                        <h5 data-id="{$list['id']}" data-status="{$list['status']}" data-name="{$list['user_name']}" data-no="{$list['user_no']}" data-mobile="{$list['mobile']}" data-remark="{$list['remark']}" >编辑</h5>
                    </td>
                </tr>
                {/if}
                {/volist}
                </tbody>
            </table>
        </div>
        <div class="add-user-info">
            <div class="aui-head">
                <div class="aui-head-cont">
                    账号注册
                </div>
            </div>
            <div class="aui-info">
                <form>
                    <input type="text" id="job-number" placeholder="工号" value=""/>
                    <input type="text" id="user-name" placeholder="姓名" value=""/>
                    <input type="tel" id="user-number" placeholder="手机号" value=""/>
                    <input type="password" id="user-password" placeholder="初始密码" value=""/>
                    <select id="remark">
                        <option value="null">直属上级</option>
                        {volist name="ucenter_data" id="ucenter_d"}
                        <option value="{$ucenter_d.id}">{$ucenter_d.user_name}</option>

                        {/volist}
                    </select>
                    <button type="button" class="aui-button">确定</button>
                    <div class="cerror">必填项不可为空</div>
                    <div class="cerror2">工号格式为数字</div>
                    <div class="cerror1"></div>
                </form>
            </div>
        </div>
        <div class="add-user-info1">
            <div class="aui-head1">
                <div class="aui-head-cont1">
                    账号编辑
                </div>
            </div>
            <div class="aui-info1">
                <form>
                    <input type="text" id="job-number1" placeholder="工号" value=""/>
                    <input type="text" id="user-name1" placeholder="姓名" value=""/>
                    <input type="tel" id="user-number1" placeholder="手机号" value=""/>
                    <input type="hidden" id="user-id1" value=""/>
                    <select id="remark1">
                        <option value="null">直属上级</option>
                        <option value="1">超级管理员</option>
                        {volist name="ucenter_data" id="ucenter_d"}

                        <option value="{$ucenter_d.id}"}>{$ucenter_d.user_name}</option>

                        {/volist}
                    </select>
                    <button type="button" class="aui-button1">确定</button>
                    <div class="cerror01" style="display: none">必填项不可为空</div>
                    <div class="cerror21">工号格式为数字</div>
                    <div class="cerror11"></div>
                </form>
            </div>
        </div>
    </div>
</div>



<script type="text/javascript" src="__PUBLIC__/js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/js.js" ></script>
<script type="text/javascript">
    $(function(){
        $(".bj").click(function(){
            $(".bj").hide();
            $(".add-user-info").hide();
        });

        $("body").css("min-height",document.documentElement.clientHeight);
        //创建账号的点击事件
        $(".auh-button").click(function(){
            $(".bj").show();
            $(".add-user-info").show();
            $("#job-number").val('');
            $("#user-name").val('');
            $("#user-number").val('');
            $("#user-password").val('');
            $("#remark").val('');
        });


        $(".bj").click(function(){
            $(".bj").hide();
            $(".add-user-info").hide();
        });
        $("#job-number,#user-name,#user-password,#remark,#uploader-demo").focus(function(){
            $(".cerror").hide()
            $(".cerror2").hide()
            $(".cerror1").hide()
        });
        $("#job-number1,#user-name1,#user-password1,#remark1,#uploader-demo1").focus(function(){
            $(".cerror01").hide()
            $(".cerror21").hide()
            $(".cerror11").hide()
        });
        //创建账号-》确定按钮点击事件
        $(".aui-button").click(function(){
            $(".cerror2").hide();
            var jobNumber		=	$("#job-number").val();
            var userName		=	$("#user-name").val();
            var userNumber		=	$("#user-number").val();
            var userPassword	=	$("#user-password").val();
            var userRemark			=	$("#remark").val();

            //判断工号、姓名、手机号等是否为空
            if(jobNumber==''||jobNumber==null||jobNumber==undefined||userName==''||userName==null||userName==undefined||userPassword==''||userPassword==null||userPassword==undefined||userRemark==''||userRemark==null||userRemark==undefined||userNumber==''||userNumber==null||userNumber==undefined){
                $(".cerror").show();
                $(".cerror").css("width","210px")
                        .css("margin-top","10px")
                        .css("margin-left","0")
                        .css("text-align","center");

            }else if(userNumber && /^1[3|4|5|8]\d{9}$/.test(userNumber)){
                //判断电话号码格式正确时，添加tr（用户）

                if(isNaN(jobNumber)){
                    $(".cerror2").show();
                }else {



                    $(".bj").hide();
                    $(".add-user-info").hide();
                    $(".operation").unbind();

                    console.log("aaa");
                    $.ajax(
                            {
                                url: '{:url('Ucenter/register')}',
                            data: {user_no : jobNumber ,user_name:userName,mobile:userNumber,password:userPassword,remark:userRemark},
                    dataType: 'json',
                            method: 'post',
                            success: function (data) {
                        if(data.status==1) {


                            window.location.reload();




                        }else {

                            alert(data.info);
                        }
                    }
                }
                )

                }
            } else{
                //判断电话号码格式错误时
                $(".cerror").show();
                $(".cerror").text("手机号格式错误");
                $(".cerror").css("width","210px")
                        .css("margin-top","10px")
                        .css("margin-left","0")
                        .css("text-align","center");
            }
            $(".bj").hide();
            $(".add-user-info").hide();
            $(".operation").unbind();
        })
    });
    $(".operation h4").click(function(){
        var number	=	$(this).attr('data-operation');
        console.log(number);
        if(number==0){
            $(this).attr('data-operation','1');
            $(this).find('h4').text('启用');
            $(this).siblings().css("color","#999");
            $(this).find('h4').css("background","green");
        }else{
            $(this).attr('data-operation','0');
            $(this).find('h4').text('停用');
            $(this).find('h4').css("background","orangered");
            $(this).siblings().css("color","#323232");
        }
    });
    //禁启用用户
    $(".operation h4").click(function(){
        var number	=	$(this).attr('data-status');

        var id	=	$(this).attr('data-id');
        console.log(number);
        console.log(id);
        $.ajax(
                {
                    url: "{:url('Ucenter/change')}",
                    data: {status:number,user_id:id},
                    dataType: 'json',
                    method: 'post',
                    success: function (data) {

                        if(data==1){

                            window.location.reload();


                        }else if(data==-1){
                            alert("超级管理员账号不能修改");
                            window.location.reload();
                        }else {
                            if(data==-2){
                                alert("当前用户禁止禁用")
                                window.location.reload();

                            }else{
                                alert("修改失败")
                                window.location.reload();

                            }

                        }


                    }
                }

        )


    });

    //用户退出
    $('.out').click(function () {

        window.location.href="{:url('Ucenter/logout')}"

    })

    //编辑用户
    $(".operation h5").click(function(){
        var user_id	=	$(this).attr('data-id');
        var user_name	=	$(this).attr('data-name');
        var user_no	=	$(this).attr('data-no');
        var user_mobile	=	$(this).attr('data-mobile');
        var user_remark	=	$(this).attr('data-remark');
        if(user_id==1){

            alert("超级管理员不能编辑");

        }else {

            $(".bj").show();
            $(".add-user-info1").show();

            $("#job-number1").val(user_no);
            $("#job-id1").val(user_id);
            $("#user-name1").val(user_name);
            $("#user-number1").val(user_mobile);
            $("#user-id1").val(user_id);
            $("#remark1").val(user_remark);
            $(".bj").click(function(){
                $(".bj").hide();
                $(".add-user-info1").hide();
            });
        }



    });

    //编辑用户确定按钮
    $(".aui-button1").click(function(){
        $(".cerror21").hide();
        var jobNumber1		=	$("#job-number1").val();
        var userName1		=	$("#user-name1").val();
        var userNumber1		=	$("#user-number1").val();
        var user_id	=	$("#user-id1").val();
        var userRemark1		=	$("#remark1").val();

        if(jobNumber1==''||jobNumber1==null||jobNumber1==undefined||userName1==''||userName1==null||userName1==undefined||userRemark1==''||userRemark1==null||userRemark1==undefined||userNumber1==''||userNumber1==null||userNumber1==undefined){
            $(".cerror01").show();
            $(".cerror01").css("width","210px")
                    .css("margin-top","10px")
                    .css("margin-left","0")
                    .css("text-align","center");

        }else if(userNumber1 && /^1[3|4|5|8]\d{9}$/.test(userNumber1)){
            //判断电话号码格式正确时，添加tr（用户）

            if(isNaN(jobNumber1)){
                $(".cerror21").show();
            }
            else if (user_id==userRemark1) {
                alert("不能选择自己")

            }else
            {

                $.ajax(
                        {
                            url:"{:url('Ucenter/editUcenter')}",
                            data: {user_no:jobNumber1,user_name:userName1,mobile:userNumber1,remark:userRemark1,id:user_id},
                            dataType: 'json',
                            method: 'post',
                            success: function (data) {
                                if(data.status=="success") {


                                    window.location.reload();



//
                                }else {

                                    alert(data.msg);
                                }
                            }


                        })}}else{
            //判断电话号码格式错误时
            $(".cerror11").show();
            $(".cerror11").text("手机号格式错误");
            $(".cerror11").css("width","210px")
                    .css("margin-top","10px")
                    .css("margin-left","0")
                    .css("text-align","center");
        }

    })
</script>
</body>
</html>
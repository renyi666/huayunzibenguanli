<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="华运、华运资本、投资、项目管理、管理系统、投资公司" />
    <meta name="description" content="" />
    <link rel="shortcut icon" href="__PUBLIC__/img/logo.ico">
    <title>华运资本项目管理系统</title>

    <link rel="stylesheet" href="__PUBLIC__/css/zui.css">
    <link rel="stylesheet" href="__PUBLIC__/css/mymine.css">

    <link type="text/css" rel="stylesheet" href="__PUBLIC__/css/style.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/jquery-ui.css" />
    <link rel="stylesheet" href="__PUBLIC__/css/main.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/webuploader.css"/>
    <link rel="stylesheet" href="__PUBLIC__/css/iconfont.css">
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5 shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--[if IE 6]>
    <script src="js/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>
        /* EXAMPLE */
        DD_belatedPNG.fix('img,.mail,.header-top-left,.header-top-right ul li a:hover,.aaa,.ztxw-right');

        /* string argument can be any CSS selector */
        /* .png_bg example is unnecessary */
        /* change it to what suits you! */
    </script>
    <![endif]-->

</head>
<body>
<header>
    <div class="row head_top">
        <div class="col-xs-11" style="width: 100%;">
            <div class="head_top_cont">
                <img src="__PUBLIC__/img/index_bj.png" class="img-responsive">
                <div class="logo">
                    <div class="logo_cont">
                        <img src="__PUBLIC__/img/logo.png">
                        <h2>华运资本项目管理系统</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="head_bottom">
        <div class="head_bottom_cont">
            <div class="exit">
                <img src="__PUBLIC__/img/exit.png">
                <h4 class="logout">退出</h4>
            </div>
            <div class="login_user">
                <img src="__PUBLIC__/img/user_icon.png">
                <h4>你好，{$userInfo.user_name}</h4>
            </div>
        </div>
    </div>
</header>
<div class="container-fluid">
    <div class="index_container">
        <div class="nav">
            <ul>
                {if condition="$menu_res.0 eq 1"}
                <li>

                    <div class="nav_item">
                        <img src="__PUBLIC__/img/jian.png">
                        <h4>项目管理</h4>
                    </div>
                    <ul>
                        {volist name="projectStage" id="stage"}

                        <li class="nav_item_li">
                            <a href="{:url('Project/index',['stage_id'=>$stage['id'],'stage_judge'=>1])}">
                                <div class="li_item">

                                    <img src="__PUBLIC__/img/sj1.png">

                                    <h5>{$stage.name}
                                        {volist name="messagestageLog" id="messagestage"}
                                        {if condition="$stage.id eq $messagestage.stage_id"}(+{$messagestage.stagenum}){/if}
                                        {/volist}</h5>
                                </div>
                            </a>
                        </li>
                        {/volist}

                    </ul>
                </li>
                {/if}
                {if condition="$menu_res.5 eq 1"}
                <li>
                    <div class="nav_item">
                        <img src="__PUBLIC__/img/jian.png">
                        <h4>日志</h4>
                    </div>
                    <ul>
                        {volist name="logtype" id="logtype"}
                        <li class="nav_item_li">
                            <a href="{:url('Log/index',['type_id'=>$logtype['id']])}">
                                <div class="li_item">
                                    <img src="__PUBLIC__/img/sj1.png">
                                    <h5>{$logtype.log_type}</h5>
                                </div>


                            </a>
                        </li>
                        {/volist}
                    </ul>
                </li>
                {/if}
                <li>
                    <a href="{:url('Process/index')}">
                        <div class="nav_item2 ">
                            <img src="__PUBLIC__/img/jia.png">
                            <h4>事项进度表</h4>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="{:url('Shenpi/index')}">
                        <div class="nav_item2 open">
                            <img src="__PUBLIC__/img/jia.png">
                            <h4>审批请示</h4>
                        </div>
                    </a>
                </li>
                {if condition="$menu_res.4 eq 1"}
                <li>
                    <a href="{:url('Newfile/share')}">
                        <div class="nav_item2">
                            <img src="__PUBLIC__/img/jia.png">
                            <h4>共享</h4>
                        </div>
                    </a>
                </li>
                {/if}
                {if condition="$menu_res.2 eq 1"}
                <li>
                    <a href="{:url('Ucenter/index')}">
                        <div class="nav_item2">
                            <img src="__PUBLIC__/img/jia.png">
                            <h4>成员管理</h4>
                        </div>
                    </a>
                </li>
                {/if}
                {if condition="$menu_res.1 eq 1"}
                <li>
                    <a href="{:url('Department/index')}">
                        <div class="nav_item2">
                            <img src="__PUBLIC__/img/jia.png">
                            <h4>设置</h4>
                        </div>
                    </a>
                </li>
                {/if}
                {if condition="$menu_res.3 eq 1"}
                <li>
                    <a href="{:url('Account/index')}">
                        <div class="nav_item2">
                            <img src="__PUBLIC__/img/jia.png">
                            <h4>账号设置</h4>
                        </div>
                    </a>
                </li>
                {/if}
            </ul>
        </div>
        <input type="hidden" value="" class="panduan">

        <div class="cont_right">
            <div class="index_right">
                <div class="index_right_top">
                    <div class="add_project">新建审批</div>
                </div>
                <div class="index_right_table">
                    <table>
                        <thead>
                        <tr>
                            <th class="action">审批名称</th>
                            <th class="action2">申请人</th>
                            <th class="action">申请时间</th>
                            <th class="action">审批类型</th>
                            <th class="action2">审批人</th>
                            <th class="action">审批时间</th>
                            <th class="action2">相关人</th>
                            <th class="action2">状态</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            {volist name="shenpiList" id="shenpilist"}
                            <td class="action shenpiname" data-id="{$shenpilist.id}" data-name="{$shenpilist.name}" data-content="{$shenpilist.content}" data-user_id="{$shenpilist.user_id}"data-to="{$shenpilist.to}" data-relation="{$shenpilist.relation}" data-type="{$shenpilist.type}" data-status="{$shenpilist.status}" >
                                <h4 title="{$shenpilist.name}" >{$shenpilist.name}</h4>
                            </td>
                            <td class="action2">{$shenpilist.user_name}</td>
                            <td class="action">{$shenpilist.create_time|date="y-m-d h:i",###}</td>
                            <td class="action">{if condition="$shenpilist.type eq 1"}请假出差{else/}申请批示{/if}</td>
                            <td class="action2">{$shenpilist.to_name}</td>
                            <td class="action">{empty name="$shenpilist.shenpi_time"}暂未审批{else/}{$shenpilist.shenpi_time|date="y-m-d h:i",###}{/empty}</td>
                            <td class="action2">{$shenpilist.relation_name}</td>
                            <td class="action2">{if condition="$shenpilist.status eq 1"}同意{elseif condition="$shenpilist.status eq 2"}拒绝{else/}审核中{/if}</td>
                        </tr>

                        {/volist}
                        </tbody>
                    </table>
                </div>
                <div class="page">
                    <div class="page_right">

                        {$shenpiList->render()}

                    </div>
                </div>
            </div>
            <div class="add_shenpi">
                <div class="as_top">
                    <div class="as_top_cont">
                        <img src="__PUBLIC__/img/fh2.png">
                        <h5>返回上一级</h5>
                    </div>
                </div>
                <div class="as_bottom">
                    <div class="asb_item">
                        <span>申请类型：</span>
                        <select class="type">
                            <option value="1">请假出差</option>
                            <option value="2">申请请示</option>
                        </select>
                    </div>
                    <div class="asb_item">
                        <span>申请标题：</span>
                        <input type="text" value=""  class="name"/>
                    </div>
                    <div class="asb_item">
                        <span>申请内容：</span>
                        <textarea class="content"></textarea>
                    </div>
                    <div class="asb_item">
                        <span>审批人：</span>
                        <select class="to">
                            {volist name="ucentaeData" id="ucent"}
                            <option value="{$ucent.id}">{$ucent.user_name}</option>
                          {/volist}
                        </select>
                    </div>
                    <div class="asb_item">
                        <span>相关人：</span>
                        <select class="relation">
                            {volist name="ucentaeData" id="ucent1"}
                            <option value="{$ucent1.id}">{$ucent1.user_name}</option>

                            {/volist}
                        </select>
                    </div>
                    <div class="asb_item">

                        <button class="asb_concel">关闭</button>
                        <button class="asb_submit">提交</button>
                    </div>

                    <div class="asb_item">

                        <button class="refuse" value="2" hidden>拒绝</button>
                        <button class="accept"  value="1" hidden>同意</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="__PUBLIC__/js/jquery-2.1.1.js"></script>

<script type="text/javascript" src="__PUBLIC__/js/jquery-ui-1.10.4.custom.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.ui.datepicker-zh-CN.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery-ui-timepicker-zh-CN.js"></script>
<script src="__PUBLIC__/js/webuploader.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/js.js" ></script>
<script type="text/javascript">
    $(function(){


        var public = "__PUBLIC__";
        /************项目管理、日志二级菜单点击事件***********/
        $(".nav_item").click(function () {
            var ul = $(this).siblings('ul');
            var display = $(this).siblings('ul').css('display');
            if (display == "block") {
                ul.hide();
                $(this).find('img').attr('src', public + '/img/jia.png');
            } else {
                ul.show();
                $(this).find('img').attr('src', public + '/img/jian.png');
            }
        });
        /**************共享 成员管理、设置鼠标事件**************/
        $(".nav ul li .nav_item2").mouseover(function () {
            $(".nav ul li .nav_item2").removeClass('active');
            $(this).addClass('active');
            $(".nav ul li .nav_item2").removeClass('action');
            $(this).prev().addClass('action');
        });
        $(".nav_item2").mouseout(function () {
            $(".nav_item2").removeClass('active');
            $(".nav_item2").removeClass('action');
        });
        /**************项目管理、日志下li的鼠标事件**************/
        $(".nav_item_li").mouseover(function () {
            $(".nav_item_li").siblings().removeClass('active');
            $(this).addClass('active');
            $(".nav_item_li").siblings().removeClass('action');
            $(this).prev().addClass('action');
            $(".nav_item_li").find('img').attr('src', public + '/img/sj1.png');
            $(this).find('img').attr('src', public + '/img/sj2.png');
        });
        $(".nav_item_li").mouseout(function () {
            $(".nav_item_li").siblings().removeClass('active');
            $(".nav_item_li").siblings().removeClass('action');
            $(".nav_item_li").find('img').attr('src', public + '/img/sj1.png');
        });
        $(".add_project").click(function () {
            $('.panduan').val("");
            $(".index_right").hide();
            $(".add_ribao").show();
        });
        $(".add_project").click(function(){

            $('.panduan').val("");
            $('.name').val("");
            $('.content').val("");
            $('.relation').val("");
            $('.to').val("");
            $('.type').val("")
            $(".index_right").hide();
            $(".add_shenpi").show();
        });
        $(".shenpiname").click(function(){

            var name=$(this).attr('data-name');
            var id=$(this).attr('data-id');
            var user_id = $(this).attr('data-user_id');
            var to =$(this).attr('data-to');
            var relation=$(this).attr('data-relation');
            var content= $(this).attr('data-content');
            var type=$(this).attr('data-type');
            var status=$(this).attr('data-status');
            $('.panduan').val(id);
            $('.name').val(name);
            $('.content').val(content);
            $('.relation').val(relation);
            $('.to').val(to);
            $('.type').val(type)


            $(".index_right").hide();


            var nowUser= {$Think.session.think.user};
           var  nowuserid=nowUser['id']
            if(nowuserid!=user_id){
                $('.asb_concel').hide();
                $('.asb_submit').hide();
            }
            if(status==0){

                if(nowuserid==to){

                    $('.refuse').show();
                    $('.accept').show();

                }else {
                    $('.refuse').hide();
                    $('.accept').hide();

                }
            }

            $(".add_shenpi").show();
        });
        $(".as_top_cont").click(function(){
            $(".index_right").show();
            $(".add_shenpi").hide();
        });
        $(".asb_concel").click(function(){

            var panduan=$('.panduan').val();
            alert(panduan)
            if (panduan==""){

            }else {

                $.ajax({
                    url: "{:url('shenpi/deleteShenpi')}",
                    data: {
                        id:panduan,
                    },
                    dataType: 'json',
                    method: 'post',
                    success: function (data) {
                        if (data > 0) {
                            window.location.reload();
                        } else {
                            alert("fail")
                        }
                    }
                })
            }
            window.location.reload();
        });

        $('.asb_submit').click(function () {
             var panduan=$('.panduan').val();
            var type=$('.type').val();
            var name=$('.name').val();
            var content =$('.content').val();
            var to =$('.to').val();
            var relation=$('.relation').val();

            console.log(type);
            console.log(name);

            console.log(content);

            console.log(to);

            console.log(relation);
            //新建
            if(panduan==null||panduan==""){
                $.ajax({
                    url: "{:url('shenpi/addNew')}",
                    data: {
                        type:type,
                        name: name,
                        content: content,
                        to: to,
                        relation: relation
                    },
                    dataType: 'json',
                    method: 'post',
                    success: function (data) {
                        if (data > 0) {
                            window.location.reload();
                        } else {
                            alert("fail")
                        }
                    }
                })
            }else {
                //编辑

                $.ajax({
                    url: "{:url('shenpi/editShenpi')}",
                    data: {
                        id:panduan,
                        type:type,
                        name: name,
                        content: content,
                        to: to,
                        relation: relation
                    },
                    dataType: 'json',
                    method: 'post',
                    success: function (data) {
                        if (data > 0) {
                            window.location.reload();
                        } else {
                            alert("fail")
                        }
                    }
                })
            }

        })

        $('.refuse').click(function () {

            var panduan=$('.panduan').val();
            var type=$('.type').val();
            var name=$('.name').val();
            var content =$('.content').val();
            var to =$('.to').val();
            var relation=$('.relation').val();
            var status=$(this).val();
            $.ajax({
                url: "{:url('shenpi/refuseShenpi')}",
                data: {
                    id:panduan,
                    status:status
                },
                dataType: 'json',
                method: 'post',
                success: function (data) {
                    if (data > 0) {

                        window.location.reload();
                    } else {
                        alert("fail")
                    }
                }
            })

        })

        $('.accept').click(function () {

            var panduan=$('.panduan').val();
            var type=$('.type').val();
            var name=$('.name').val();
            var content =$('.content').val();
            var to =$('.to').val();
            var relation=$('.relation').val();
            var status=$(this).val();
            $.ajax({
                url: "{:url('shenpi/refuseShenpi')}",
                data: {
                    id:panduan,
                    status:status
                },
                dataType: 'json',
                method: 'post',
                success: function (data) {
                    if (data > 0) {

                        window.location.reload();
                    } else {
                        alert("fail")
                    }
                }
            })

        })
        //退出
        $('.logout').click(function () {

            window.location.href = "{:url('Ucenter/logout')}"
        })
    })
</script>
</body>
</html>